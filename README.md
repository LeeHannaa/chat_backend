### 디디하우스 채팅 기능 서비스

1. **소개**
   - 디디하우스 앱/웹 내 채팅 기능 도입 (1:1) -> 단체 채팅 확장 (비회원 쪽지 문의 추가) -> 기획 변경 (유저 기준으로 채팅방 관리, 비회원 쪽지 x -> 채팅) -> 서버 부하 고려 (웹소켓 연결 재설계)
2. **기간**
   - 2025.02.13 ~ 2025.06.20
   - (2025.02.21 ~ 2025.03.06 x)
3. **채팅 기능 개발 과정**
   1. **웹소켓 통신을 통한 실시간 채팅**
       1. **구독 경로**
          - **유저의 아이디 구독**
             - 각 유저는 자신의 아이디로 구독 경로 접속 (로그인 이후)
             - 메시지를 전송하게 될 경우 받는 사람의 아이디를 찾아 해당 경로로 메시지 전송
             - 실시간 알림 및 채팅 내역 확인
       2. **전송 타입 지정**
           - **CLEAR_ROOM** (채팅방 생성 완료 알림)
           - **CHATLIST** (채팅방 리스트 수신 알림)
           - **CHAT** (채팅 전송 알림)
           - **INFO** (상대가 채팅방에 입장 알림) - 읽음 처리 해야하는 메시지 수 같이 전달
           - **OUT** (상대가 채팅방에 퇴장 알림)
           - **INVITE** (채팅방에 유저 초대 알림)
           - **LEAVE** (유저가 채팅방을 나갔다는 알림) -  읽음 처리 해야하는 메시지 수 같이 전달
           - **DELETE** (채팅 메시지 전체 삭제 알림) - 전체 삭제 한 메시지 id : “삭제된 메시지입니다.” 처리
   2. **Redis를 사용해 읽음/안읽음 처리 (단체 채팅으로 확장하면서 수정)**
      - **저장하는 데이터**
           1. **채팅방 접속자 수**
               - 실시간 채팅방 접속 인원 파악 (메시지 바로 읽음 처리)
           2. **메시지 읽음 여부**
               - 각 채팅 메시지 당 안읽은 유저 파악 (단체 채팅 시 읽음 처리 여부)
               - 해당 채팅방에 유저가 읽지 않은 메시지 수 파악
   3. **Cassandra DB를 사용해 대용량 채팅 메시지 데이터 저장** -> 변경된 버전에서는 mysql만 사용
       1. 수평적 확장성으로 특정 노드에 부하가 몰리지 않도록 데이터가 클러스터 전체에 자동으로 분산
       2. 하나의 노드에 장애가 발생해도 전체 시스템은 계속 작동
       3. 대용량의 데이터를 빠르게 쓰기/읽기
   5. **FCM 알림**
       1. Firebase의 FCM 기능을 이용해 어플리케이션에서 알림 전송
       2. 클라이언트 측에서 fcm token을 받아와 서버로 전달하여 db에 저장 (한 유저 당 하나 → 추후 확장한다면 한 유저당 fcm token을 여러개 가지도록 수정 가능)
       3. 실시간 메시지가 전송되는 과정에서 fcm token이 있다면 해당 토큰을 이용해 알림 전송
4. **사용 기술**
    1. springboot, java17, jpa -> mybatis
    2. redis, cassandraDB, mysql
    3. fcm 서비스, webSocket
5. **API 기능 명세**
   - <a href="https://www.notion.so/API-chat-erd-1e5caaf36f6f80218fe2f4eb729f0a44" style="color: black;">API 기능 명세 정리 바로가기</a>
6. **ERD**
    - <a href="https://www.erdcloud.com/d/oYJioMa5pvRzWurB7" style="color: black;">ERD 바로가기</a>
    
